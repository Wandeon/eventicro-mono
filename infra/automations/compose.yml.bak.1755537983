services:
  n8n:
    image: n8nio/n8n:latest
    command: ["start"]
    restart: unless-stopped
    ports:
      - "127.0.0.1:5678:5678"        # keep private; publish via Caddy if needed
    environment:
      TZ: Europe/Zagreb
      N8N_BASIC_AUTH_ACTIVE: "true"
      N8N_BASIC_AUTH_USER: "${N8N_BASIC_AUTH_USER}"
      N8N_BASIC_AUTH_PASSWORD: "${N8N_BASIC_AUTH_PASSWORD}"
      N8N_ENCRYPTION_KEY: "${N8N_ENCRYPTION_KEY}"
      N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS: "true"
      WEBHOOK_URL: "${N8N_WEB_URL}"
    volumes:
      - n8n-data:/home/node/.n8n
    networks:
      - default
      - core_default

networks:
  core_default:
    external: true

volumes:
  n8n-data:
    external: true
    name: automations_n8n-data-fresh
